(()=>{"use strict";let e,t=[],r=new Set,o=!0;function n(e){try{return new URL(e,window.location.href).href}catch(t){return e}}function i(e){var t;if(!e)return null;const r=null===(t=e.textContent)||void 0===t?void 0:t.trim();return r&&r.length?r:null}function s(e){if(!e)return null;const t=e.match(/(\d{1,3})/);return t?parseInt(t[1],10):null}function a(e){const t=e.querySelector('a[href*="/profile"], a[href*="/user"], a'),r=n(t?t.href:e.getAttribute("data-url")||window.location.href),o=function(e){try{const t=new URL(e,window.location.href).pathname.split("/").filter(Boolean);return t.length?t[t.length-1]:e}catch(t){return e}}(r||window.location.href);if(!o)return null;const a=e.querySelector('[data-test="user-name"], .user-name, .profile-name, h3, h2, .name'),c=e.querySelector(".age, .user-age"),u=e.querySelector(".location, .user-location"),l=e.querySelector(".bio, .description, .user-bio"),d=Array.from(e.querySelectorAll("img")).map(e=>e.src||e.getAttribute("data-src")||"").filter(Boolean).map(n);return{id:o,url:r,name:i(a)||void 0,age:s(i(c)),location:i(u)||void 0,photos:d.length?d:void 0,bio:i(l)||void 0,scrapedAt:(new Date).toISOString()}}function c(o){r.has(o.id)||(r.add(o.id),t.push(o),t.length>=10&&u(),e||(e=window.setTimeout(()=>{e=void 0,u()},5e3)))}function u(){if(!t.length)return;const e=t.slice();t=[];try{chrome.runtime.sendMessage({type:"SCRAPE_BATCH",items:e},e=>{})}catch(e){console.error("Failed to send scrape batch",e)}}function l(){if(!o)return;const e=Array.from(document.querySelectorAll('[data-test="user-card"], .user-card, .profile, .profile-item, [data-qa="card"]'));e.length||Array.from(document.querySelectorAll('a[href*="/profile"], a[href*="/user"]')).forEach(t=>{const r=t.closest("article, li, div");r&&e.push(r)});for(const t of e){const e=a(t);e&&c(e)}}const d=new MutationObserver(e=>{for(const t of e)if(t.addedNodes&&t.addedNodes.length){l();break}});function f(){d.observe(document.body,{childList:!0,subtree:!0}),l()}chrome.runtime.onMessage.addListener((t,r,n)=>{t&&t.type&&("START_SCRAPING"===t.type?(o=!0,f(),n({status:"started"})):"STOP_SCRAPING"===t.type?(d.disconnect(),o=!1,e&&(clearTimeout(e),e=void 0),u(),n({status:"stopped"})):"FLUSH"===t.type&&(u(),n({status:"flushed"})))}),(()=>{const e=history.pushState;history.pushState=function(...t){const r=e.apply(this,t);return setTimeout(l,500),r};const t=history.replaceState;history.replaceState=function(...e){const r=t.apply(this,e);return setTimeout(l,500),r},window.addEventListener("popstate",()=>setTimeout(l,500))})(),f(),window.__badooScraper={flush:u,getBuffer:()=>t.slice(),getSeen:()=>Array.from(r)}})();
//# sourceMappingURL=content.js.map