(()=>{"use strict";({89:function(){var o=this&&this.__awaiter||function(o,t,e,n){return new(e||(e=Promise))(function(r,a){function s(o){try{c(n.next(o))}catch(o){a(o)}}function l(o){try{c(n.throw(o))}catch(o){a(o)}}function c(o){var t;o.done?r(o.value):(t=o.value,t instanceof e?t:new e(function(o){o(t)})).then(s,l)}c((n=n.apply(o,t||[])).next())})};const t="scrapedProfiles";function e(){return o(this,void 0,void 0,function*(){return new Promise(o=>{chrome.storage.local.get([t],e=>{const n=e[t]||{};o(n)})})})}function n(e){return o(this,void 0,void 0,function*(){return new Promise(o=>{const n={};n[t]=e,chrome.storage.local.set(n,()=>o())})})}chrome.runtime.onInstalled.addListener(()=>{console.log("Badoo Scraper: installed")}),chrome.runtime.onMessage.addListener((t,r,a)=>(o(void 0,void 0,void 0,function*(){try{if(!t||!t.type)return;if("SCRAPE_BATCH"===t.type){const r=t.items||[],s=yield e();let l=0;for(const o of r)o&&o.id&&(s[o.id]||(s[o.id]=o,l++));yield n(s),a({status:"ok",added:l,total:Object.keys(s).length});try{chrome.storage.sync.get(["uploadUrl","autoUpload","proxy"],t=>o(void 0,void 0,void 0,function*(){const e=t&&t.uploadUrl?t.uploadUrl:null,n=t&&t.autoUpload,a=t&&t.proxy?t.proxy:null;if(e&&n)try{yield function(t,e,n){return o(this,void 0,void 0,function*(){try{const o=JSON.stringify({profiles:e,proxy:n}),r=yield fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:o});if(!r.ok){const o=yield r.text();throw new Error(`Upload failed: ${r.status} ${r.statusText} - ${o}`)}return yield r.json().catch(()=>({}))}catch(o){throw o}})}(e,r,a),console.log("Auto-uploaded batch to",e)}catch(o){console.error("Auto-upload failed",o)}}))}catch(o){console.warn("Failed to check auto-upload config",o)}}else if("EXPORT_CSV"===t.type){const o=(r=yield e(),Object.keys(r).map(o=>r[o])),n=function(o){const t=[["id","url","name","age","location","photos","bio","scrapedAt"].join(",")];for(const n of o){const o=[e(n.id),e(n.url),e(n.name),null!=n.age?String(n.age):"",e(n.location),e(n.photos?n.photos.join(" | "):""),e(n.bio),e(n.scrapedAt)];t.push(o.join(","))}return t.join("\n");function e(o){if(null==o)return"";const t=String(o).replace(/"/g,'""');return t.includes(",")||t.includes("\n")||t.includes('"')?`"${t}"`:t}}(o);if(t&&t.backgroundDownload)try{const e="data:text/csv;charset=utf-8,"+encodeURIComponent(n),r=t.filename||`badoo-scrape-${(new Date).toISOString().replace(/[:.]/g,"-")}.csv`;chrome.downloads.download({url:e,filename:r},()=>{}),a({status:"ok",downloaded:!0,count:o.length})}catch(o){console.error("Background download failed",o),a({status:"error",error:String(o)})}else a({status:"ok",csv:n,count:o.length})}else if("CLEAR_SCRAPED"===t.type)yield n({}),a({status:"ok",cleared:!0});else if("GET_COUNT"===t.type){const o=yield e();a({status:"ok",count:Object.keys(o).length})}else{if("GET_PROXY"===t.type)return void chrome.storage.sync.get(["proxy"],o=>{a({status:"ok",proxy:o&&o.proxy?o.proxy:null})});if("SAVE_PROXY"===t.type){const o=t.proxy||null;return void chrome.storage.sync.set({proxy:o},()=>{a({status:"ok",saved:!0})})}if("SAVE_UPLOAD_URL"===t.type){const o=t.uploadUrl||null,e=!!t.autoUpload;return void chrome.storage.sync.set({uploadUrl:o,autoUpload:e},()=>{a({status:"ok",saved:!0})})}if("GET_UPLOAD_URL"===t.type)return void chrome.storage.sync.get(["uploadUrl","autoUpload"],o=>{a({status:"ok",uploadUrl:o&&o.uploadUrl?o.uploadUrl:null,autoUpload:!(!o||!o.autoUpload)})})}}catch(o){console.error("background onMessage error",o),a({status:"error",error:String(o)})}var r}),!0))}})[89].call({})})();
//# sourceMappingURL=background.js.map